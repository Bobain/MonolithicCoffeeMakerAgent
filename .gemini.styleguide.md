# Gemini Style Guide

**Owner**: code-sanitizer
**Purpose**: Code quality and maintainability guidelines
**Last Updated**: 2025-10-15

## Code Quality Principles

### 1. Simplicity
- Functions should do ONE thing
- Maximum function length: 50 lines
- Maximum class length: 300 lines
- Prefer composition over inheritance

### 2. Readability
- Clear variable names (no abbreviations)
- Descriptive function names (verb + noun)
- Type hints for all functions
- Docstrings for all public functions

### 3. Maintainability
- DRY (Don't Repeat Yourself)
- Single Responsibility Principle
- Minimal dependencies between modules
- Clear error messages

### 4. Testability
- Pure functions when possible
- Dependency injection
- Avoid global state
- Mock-friendly interfaces

## Code Metrics Thresholds

### Complexity
- **Cyclomatic Complexity**: ≤ 10 per function
- **Cognitive Complexity**: ≤ 15 per function
- **Lines of Code**: ≤ 50 per function, ≤ 300 per file

### Dependencies
- **Import depth**: ≤ 5 levels
- **Circular imports**: 0 (forbidden)
- **External dependencies**: Minimize, architect approval required

### Duplication
- **Code duplication**: ≤ 3% of codebase
- **Similar functions**: Extract to shared utility

## Refactoring Triggers

### High Priority (Immediate)
- Cyclomatic complexity > 15
- Function length > 100 lines
- Duplicated code blocks > 20 lines
- Security vulnerabilities
- Performance bottlenecks (>1s execution)

### Medium Priority (Next sprint)
- Cyclomatic complexity 10-15
- Function length 50-100 lines
- Missing type hints
- Poor test coverage (<70%)
- Unclear naming

### Low Priority (Backlog)
- Minor style inconsistencies
- Optimization opportunities
- Documentation improvements
- Code comments cleanup

## Python-Specific Guidelines

### Naming Conventions
- **Classes**: PascalCase
- **Functions**: snake_case
- **Constants**: UPPER_SNAKE_CASE
- **Private**: _leading_underscore

### Type Hints
```python
# Good
def calculate_total(prices: List[float], tax_rate: float) -> float:
    return sum(prices) * (1 + tax_rate)

# Bad
def calculate_total(prices, tax_rate):
    return sum(prices) * (1 + tax_rate)
```

### Error Handling
```python
# Good
def load_config(path: Path) -> Dict[str, Any]:
    try:
        return json.loads(path.read_text())
    except FileNotFoundError:
        raise ConfigError(f"Config not found: {path}")
    except json.JSONDecodeError as e:
        raise ConfigError(f"Invalid JSON: {e}")

# Bad
def load_config(path):
    return json.loads(open(path).read())
```

## Tools for Analysis

### Automated Checks
- **pylint**: Code quality and style
- **flake8**: PEP 8 compliance
- **mypy**: Type checking
- **radon**: Complexity metrics
- **bandit**: Security analysis

### Manual Review Areas
- Architecture decisions
- API design
- Performance critical paths
- Security-sensitive code
- Complex algorithms

## Refactoring Patterns

### Extract Function
When: Function > 50 lines or doing multiple things
```python
# Before
def process_order(order):
    # validate (10 lines)
    # calculate (15 lines)
    # save (10 lines)
    # notify (10 lines)

# After
def process_order(order):
    validate_order(order)
    total = calculate_total(order)
    save_order(order, total)
    notify_user(order)
```

### Extract Class
When: Related functions operating on same data
```python
# Before
def calculate_price(items):
    ...
def apply_discount(items, discount):
    ...
def calculate_tax(items):
    ...

# After
class PriceCalculator:
    def calculate(self, items): ...
    def apply_discount(self, discount): ...
    def calculate_tax(self): ...
```

### Replace Magic Numbers
```python
# Before
if user.age > 18:

# After
LEGAL_AGE = 18
if user.age > LEGAL_AGE:
```

## Review Checklist

Before marking code as "clean":
- [ ] All functions < 50 lines
- [ ] All complexity scores < 10
- [ ] Type hints present
- [ ] Docstrings complete
- [ ] No code duplication
- [ ] Tests passing
- [ ] No security warnings
- [ ] Performance acceptable

---

**Maintained By**: code-sanitizer
**Review Frequency**: After every code_developer commit
**Next Review**: Automatic (on code changes)

# US-025: Interactive Demo File for Pull Requests

**Status**: üìù Planned
**Priority**: Medium
**Estimate**: 1-2 hours per PR

## User Story
As a **user**,
I want **each pull request to contain a demo file**,
So that I can **test the new features step-by-step** with guided instructions and examples.

## Problem
Currently, when a PR is opened:
- ‚ùå No step-by-step testing guide provided
- ‚ùå User must read code/docs to understand how to test
- ‚ùå Easy to miss edge cases or important workflows
- ‚ùå No clear "acceptance test" for the user to run
- ‚ùå User doesn't know if feature is working correctly

**Impact**:
- User can't easily test new features
- Risk of merging untested functionality
- Poor user experience during review
- Slower PR approval process

## Proposed Solution
Include a `DEMO_<PR-NUMBER>.md` file in every pull request that:
1. Lists all new features/changes
2. Provides step-by-step testing instructions
3. Includes example commands to run
4. Shows expected outputs
5. Lists edge cases to verify
6. Includes rollback instructions if needed

### Demo File Structure

```markdown
# DEMO: <PR Title>

**PR**: #<number>
**Branch**: `<branch-name>`
**User Story**: US-XXX

---

## üéØ What's New

Brief description of changes (2-3 sentences).

**Features Added**:
- ‚ú® Feature 1: Description
- ‚ú® Feature 2: Description
- üêõ Bug Fixed: Description

**Files Changed**: X files changed (+Y, -Z lines)

---

## üìã Prerequisites

Before testing, ensure you have:
- [ ] Python 3.11+ installed
- [ ] Poetry installed
- [ ] Required environment variables set (.env file)
- [ ] Clean git working directory
- [ ] All dependencies installed: `poetry install`

---

## üß™ Step-by-Step Testing Guide

### Step 1: Checkout the PR Branch

```bash
# Option A: Checkout directly
git fetch origin
git checkout <branch-name>

# Option B: Using GitHub CLI
gh pr checkout <pr-number>
```

**Expected**: Branch switched successfully, no errors.

---

### Step 2: Install/Update Dependencies

```bash
poetry install
```

**Expected**: All dependencies installed successfully.

---

### Step 3: Test Feature 1 - <Feature Name>

**Purpose**: Verify that <feature> works as expected.

**Commands**:
```bash
# Example command 1
poetry run <command>

# Example command 2
poetry run <command> --option
```

**Expected Output**:
```
<Expected console output>
```

**What to Verify**:
- ‚úÖ Output matches expected format
- ‚úÖ No error messages
- ‚úÖ Files created/modified as expected

---

### Step 4: Test Feature 2 - <Feature Name>

**Purpose**: Verify that <feature> works as expected.

**Commands**:
```bash
# Example commands
```

**Expected Output**:
```
<Expected console output>
```

---

### Step 5: Test Edge Cases

#### Edge Case 1: <Scenario>

**Commands**:
```bash
# Commands to test edge case
```

**Expected**: <Expected behavior>

#### Edge Case 2: <Scenario>

**Commands**:
```bash
# Commands to test edge case
```

**Expected**: <Expected behavior>

---

## ‚úÖ Acceptance Criteria Verification

Test each acceptance criterion from the user story:

### Must Have
- [ ] **Criterion 1**: <Description>
  - Test: `<command to verify>`
  - Expected: <expected result>

- [ ] **Criterion 2**: <Description>
  - Test: `<command to verify>`
  - Expected: <expected result>

### Should Have
- [ ] **Criterion 3**: <Description>
  - Test: `<command to verify>`
  - Expected: <expected result>

---

## üêõ Known Issues / Limitations

- ‚ö†Ô∏è Issue 1: <description>
  - Workaround: <how to work around it>

- ‚ö†Ô∏è Issue 2: <description>
  - Planned fix: US-XXX

---

## üîÑ Rollback Instructions

If you need to revert these changes:

```bash
# Switch back to main/roadmap branch
git checkout roadmap

# Or reset to previous commit
git reset --hard <previous-commit-sha>
```

---

## üì∏ Screenshots / Examples

### Before
```
<Example of old behavior/output>
```

### After
```
<Example of new behavior/output>
```

---

## üí° Tips & Best Practices

- **Tip 1**: <Helpful advice for using the feature>
- **Tip 2**: <Common pitfall to avoid>
- **Tip 3**: <Performance consideration>

---

## üìö Related Documentation

- User Story: `tickets/US-XXX.md`
- Technical Spec: `docs/US-XXX_TECHNICAL_SPEC.md`
- Updated Docs:
  - `docs/GUIDE.md` - Section X.X
  - `docs/API.md` - New endpoints

---

## ‚ùì Troubleshooting

### Problem 1: <Common issue>
**Symptom**: <what user sees>
**Solution**: <how to fix it>

### Problem 2: <Common issue>
**Symptom**: <what user sees>
**Solution**: <how to fix it>

---

## ‚úÖ Review Checklist

After testing, verify:
- [ ] All features work as described
- [ ] No errors or warnings in console
- [ ] Code is clean and readable
- [ ] Tests pass (if applicable)
- [ ] Documentation is updated
- [ ] Performance is acceptable
- [ ] Ready to merge to main

---

## üéâ Feedback

Did this demo help you test the PR? Any suggestions for improvement?

Please comment on the PR with your feedback!
```

---

## Example: DEMO for US-021 Phase 1

Here's what a demo file for the current US-021 Phase 1 PR would look like:

### File: `DEMO_US-021_PHASE_1.md`

```markdown
# DEMO: US-021 Phase 1 - Code Refactoring & Technical Debt Reduction

**PR**: #XXX (to be created)
**Branch**: `feature/us-021-refactoring-phase-1`
**User Story**: US-021

---

## üéØ What's New

This PR completes Phase 1 of the code refactoring initiative, focusing on eliminating code duplication through centralized utilities.

**Features Added**:
- ‚ú® **ConfigManager**: Centralized API key management (eliminates 15+ duplicated blocks)
- ‚ú® **File I/O Utilities**: Centralized JSON operations with atomic writes (eliminates 10+ duplicated patterns)
- üìù **Enhanced Documentation**: Comprehensive module docstrings for github.py and daemon.py
- üìã **New User Stories**: Created US-022 (langchain_observe consolidation), US-023 (settings management), US-024 (frequent roadmap sync)

**Files Changed**: 24 files changed (+2,500, -500 lines)

---

## üìã Prerequisites

Before testing, ensure you have:
- [x] Python 3.11+ installed
- [x] Poetry installed
- [x] Clean git working directory
- [x] All dependencies installed: `poetry install`

---

## üß™ Step-by-Step Testing Guide

### Step 1: Checkout the PR Branch

```bash
git fetch origin
git checkout feature/us-021-refactoring-phase-1
```

**Expected**: Branch switched successfully.

---

### Step 2: Test ConfigManager - API Key Loading

**Purpose**: Verify ConfigManager centralizes API key management.

**Test 1 - Load Anthropic API Key**:
```bash
python3 -c "from coffee_maker.config import ConfigManager; print('Anthropic API Key:', 'SET' if ConfigManager.has_anthropic_api_key() else 'NOT SET')"
```

**Expected Output**:
```
Anthropic API Key: SET
```

**Test 2 - Load GitHub Token**:
```bash
python3 -c "from coffee_maker.config import ConfigManager; print('GitHub Token:', 'SET' if ConfigManager.has_github_token() else 'NOT SET')"
```

**Expected Output**:
```
GitHub Token: SET
```

**Test 3 - Handle Missing Key**:
```bash
python3 -c "from coffee_maker.config import ConfigManager; ConfigManager.get_anthropic_api_key()" || echo "Error handled correctly"
```

**Expected**: If key missing, raises APIKeyMissingError with helpful message.

---

### Step 3: Test File I/O Utilities - JSON Operations

**Purpose**: Verify centralized JSON utilities work correctly.

**Test 1 - Write JSON File**:
```bash
python3 -c "
from coffee_maker.utils.file_io import write_json_file
import tempfile
import os
temp_file = tempfile.mktemp(suffix='.json')
data = {'test': 'value', 'number': 42}
write_json_file(temp_file, data)
print(f'File created: {os.path.exists(temp_file)}')
os.unlink(temp_file)
"
```

**Expected Output**:
```
File created: True
```

**Test 2 - Read JSON File**:
```bash
python3 -c "
from coffee_maker.utils.file_io import read_json_file, write_json_file
import tempfile
import os
temp_file = tempfile.mktemp(suffix='.json')
data = {'test': 'value'}
write_json_file(temp_file, data)
loaded = read_json_file(temp_file)
print(f'Data matches: {loaded == data}')
os.unlink(temp_file)
"
```

**Expected Output**:
```
Data matches: True
```

**Test 3 - Atomic Write Safety**:
```bash
python3 -c "
from coffee_maker.utils.file_io import write_json_file
import tempfile
temp_file = tempfile.mktemp(suffix='.json')
# Write twice - second should not corrupt first
write_json_file(temp_file, {'version': 1})
write_json_file(temp_file, {'version': 2})
print('Atomic writes work correctly')
import os; os.unlink(temp_file)
"
```

**Expected**: No errors, atomic writes prevent corruption.

---

### Step 4: Verify Documentation Improvements

**Test 1 - Check github.py Docstring**:
```bash
python3 -c "from coffee_maker.utils.github import GitHubPRClient; help(GitHubPRClient)" | head -20
```

**Expected**: Comprehensive docstring with examples shown.

**Test 2 - Check daemon.py Docstring**:
```bash
python3 -c "from coffee_maker.autonomous.daemon import DevDaemon; help(DevDaemon)" | head -30
```

**Expected**: Enhanced docstring with architecture diagram shown.

---

### Step 5: Verify Migrations Work

**Purpose**: Confirm migrated files use new utilities.

**Test 1 - Check process_manager.py Uses File I/O**:
```bash
grep "from coffee_maker.utils.file_io import" coffee_maker/process_manager.py
```

**Expected Output**:
```
from coffee_maker.utils.file_io import read_json_file, write_json_file
```

**Test 2 - Check daemon.py Uses ConfigManager**:
```bash
grep "from coffee_maker.config import ConfigManager" coffee_maker/autonomous/daemon.py
```

**Expected**: ConfigManager import found.

---

## ‚úÖ Acceptance Criteria Verification

### Phase 1: Code Quality Foundations
- [x] **ConfigManager**: Eliminates 15+ duplicated API key blocks
  - Test: `grep -r "os.getenv.*ANTHROPIC" coffee_maker/` (should show minimal matches)
  - Expected: Only ConfigManager uses os.getenv

- [x] **File I/O Utilities**: Eliminates 10+ duplicated JSON operations
  - Test: `grep -r "json.dump\|json.load" coffee_maker/ | wc -l` (should be reduced)
  - Expected: Centralized in file_io.py

- [x] **Documentation**: Enhanced module docstrings
  - Test: Check github.py and daemon.py have comprehensive docs
  - Expected: Detailed docstrings with examples

---

## üêõ Known Issues / Limitations

- ‚ö†Ô∏è Mypy still has 232 errors (down from 242)
  - Future work: Continue fixing type errors incrementally

- ‚ö†Ô∏è Large files not yet split (chat_interface.py: 1,215 lines)
  - Planned: Phase 2 will split large files

---

## üîÑ Rollback Instructions

If you need to revert:

```bash
# Switch back to roadmap
git checkout roadmap

# View recent commits
git log --oneline -n 5
```

---

## üì∏ Before/After Examples

### Before: Duplicated API Key Loading
```python
# In 15+ different files:
api_key = os.getenv("ANTHROPIC_API_KEY")
if not api_key:
    raise ValueError("ANTHROPIC_API_KEY not set")
```

### After: Centralized ConfigManager
```python
# In all files now:
from coffee_maker.config import ConfigManager
api_key = ConfigManager.get_anthropic_api_key()
```

### Before: Duplicated JSON Operations
```python
# In 10+ different files:
with open(file_path, 'w') as f:
    json.dump(data, f, indent=2)
```

### After: Centralized File I/O
```python
# In all files now:
from coffee_maker.utils.file_io import write_json_file
write_json_file(file_path, data)
```

---

## üí° Tips & Best Practices

- **Tip 1**: Always use ConfigManager for API keys - never access os.getenv directly
- **Tip 2**: Use file_io utilities for all JSON operations - atomic writes prevent corruption
- **Tip 3**: Check module docstrings with `help()` for usage examples

---

## üìö Related Documentation

- User Story: `tickets/US-021.md`
- Technical Spec: `docs/US_021_TECHNICAL_SPEC.md`
- Progress Tracking: `docs/US-021_PROGRESS.md`
- Code Duplication Analysis: `docs/code_duplication_analysis.md`
- New User Stories:
  - `tickets/US-022.md` - langchain_observe consolidation
  - `tickets/US-023.md` - Settings management UI
  - `tickets/US-024.md` - Frequent roadmap synchronization

---

## ‚úÖ Review Checklist

After testing, verify:
- [ ] ConfigManager loads API keys correctly
- [ ] File I/O utilities work for read/write operations
- [ ] Atomic writes prevent file corruption
- [ ] Module docstrings are comprehensive
- [ ] No regressions in existing functionality
- [ ] All pre-commit hooks pass
- [ ] Ready to merge to roadmap

---

## üéâ Feedback

Did this demo help you test the refactoring changes?

Please comment on the PR with your testing results!
```

---

## Implementation Guidelines

### For code_developer:

**When creating a PR, always include a DEMO file** that follows this template. The demo file should:

1. **Be Created Before Opening PR**
   - Write demo file as last step before creating PR
   - Commit it to the feature branch
   - Include in PR description

2. **Be Comprehensive**
   - Cover all new features
   - Include step-by-step instructions
   - Provide example commands
   - Show expected outputs

3. **Be Tested**
   - Actually run through the demo yourself
   - Verify all commands work
   - Confirm expected outputs match reality

4. **Be User-Focused**
   - Write for non-technical users
   - Explain WHY, not just HOW
   - Include troubleshooting section
   - Add rollback instructions

### Automation Opportunity

Create a script/tool that:
- Generates DEMO template from PR metadata
- Auto-populates PR number, branch name, user story
- Extracts changed files and git stats
- Suggests test commands based on changed files
- **Tool location**: `scripts/generate_pr_demo.py`

---

## Acceptance Criteria

### Must Have
- [ ] Every PR includes a DEMO_<PR-NUMBER>.md file
- [ ] Demo file follows the template structure
- [ ] Step-by-step testing instructions provided
- [ ] Example commands with expected outputs shown
- [ ] Edge cases documented and tested
- [ ] Rollback instructions included
- [ ] User can test the PR without reading code

### Should Have
- [ ] Screenshots or examples of before/after
- [ ] Troubleshooting section for common issues
- [ ] Tips and best practices included
- [ ] Links to related documentation
- [ ] Review checklist for user verification

### Nice to Have
- [ ] Video demo or screencast (for complex features)
- [ ] Interactive demo script (run-demo.sh)
- [ ] Automated demo generation tool
- [ ] Demo file template in .github/PULL_REQUEST_TEMPLATE/
- [ ] CI check that verifies demo file exists

---

## Benefits

### For Users
- ‚úÖ **Easy Testing**: Clear step-by-step guide
- ‚úÖ **Confidence**: Verify features work before merging
- ‚úÖ **Learning**: Understand new features through examples
- ‚úÖ **Safety**: Rollback instructions if something breaks

### For Developers
- ‚úÖ **Quality**: Forces thinking about user experience
- ‚úÖ **Documentation**: Demo doubles as usage guide
- ‚úÖ **Feedback**: Users can test and provide early feedback
- ‚úÖ **Acceptance**: Clear criteria for "done"

---

## Example Script: `scripts/generate_pr_demo.py`

```python
#!/usr/bin/env python3
"""Generate PR demo file from git metadata and templates."""

import argparse
import subprocess
from pathlib import Path

def get_current_branch():
    return subprocess.check_output(
        ["git", "branch", "--show-current"],
        text=True
    ).strip()

def get_file_stats():
    result = subprocess.run(
        ["git", "diff", "--stat", "roadmap"],
        capture_output=True,
        text=True
    )
    return result.stdout

def generate_demo_file(pr_number: int, user_story: str):
    branch = get_current_branch()
    stats = get_file_stats()

    template = f"""# DEMO: <PR Title>

**PR**: #{pr_number}
**Branch**: `{branch}`
**User Story**: {user_story}

---

## üéØ What's New

<Brief description of changes>

**Files Changed**:
```
{stats}
```

---

## üìã Prerequisites

Before testing, ensure you have:
- [ ] Python 3.11+ installed
- [ ] Poetry installed
- [ ] Dependencies installed: `poetry install`

---

## üß™ Step-by-Step Testing Guide

### Step 1: Checkout the PR Branch

```bash
git checkout {branch}
```

<Continue with template...>
"""

    output_file = Path(f"DEMO_{pr_number}.md")
    output_file.write_text(template)
    print(f"‚úÖ Demo file created: {output_file}")

if __name__ == "__main__":
    parser = argparse.ArgumentParser(description="Generate PR demo file")
    parser.add_argument("pr_number", type=int, help="PR number")
    parser.add_argument("--user-story", default="<US-XXX>", help="User story ID")

    args = parser.parse_args()
    generate_demo_file(args.pr_number, args.user_story)
```

---

## Success Metrics

After implementation:
- 100% of PRs include demo files
- Users can test PRs without asking questions >80% of the time
- PR review time reduced by 30% (clearer testing process)
- User satisfaction with PR quality increased

---

## Related User Stories
- US-021: Code Refactoring (example PR that needs demo)
- US-024: Frequent Roadmap Sync (improves PR visibility)
- US-009: Documentation & Tutorials (related to user guides)

---

ü§ñ **Created**: 2025-10-11 by code_developer (autonomous)
**Estimated Implementation Time**: 1-2 hours per PR (template creation + testing)
**Priority**: Medium (improves user experience and PR quality)

# BUG-068: CFR-014 violation: orchestrator using JSON files instead of database

**Status**: ðŸŸ¡ In Progress
**Priority**: High
**Created**: 2025-10-20T16:24:19.098764
**Reporter**: user_listener
**Assigned**: code_developer
**Category**: logic

## Description

The orchestrator-agent-management skill violates CFR-014 by using JSON files for state tracking instead of the orchestrator.db database.

CFR-014 states: "ALL orchestrator activities in SQLite database. JSON files FORBIDDEN."

Current implementation:
- Uses data/orchestrator/work_loop_state.json for active tasks
- Uses data/orchestrator/agent_state.json for agent tracking

Should use:
- data/orchestrator.db â†’ agent_lifecycle table (already exists with proper schema)
- data/orchestrator.db â†’ tasks table (already exists)

Expected behavior: All agent spawns, lifecycle events, and task tracking written to database.
Actual behavior: orchestrator-agent-management skill writes to JSON files instead of database.

Impact: Database has 72 historical agents, but recent agents (PID 31159, 31280-31282) are missing.

## Reproduction Steps

1. Start orchestrator: poetry run orchestrator start
2. Check JSON files: ls -la data/orchestrator/*.json
3. Check database: sqlite3 data/orchestrator.db "SELECT pid FROM agent_lifecycle WHERE pid IN (31159, 31280, 31281, 31282)"
4. Observe: Recent PIDs not in database, only in JSON files

## Expected Behavior

_To be determined during analysis_

## Actual Behavior

_To be determined during analysis_

## Definition of Done

- [ ] Bug reproduced locally
- [ ] Root cause identified
- [ ] Technical specification written
- [ ] Fix implemented
- [ ] Regression tests added
- [ ] All tests passing
- [ ] No regressions in existing functionality
- [ ] Documentation updated if needed
- [ ] PR created and reviewed
- [ ] User validated fix

## Analysis (code_developer)

_Phase 1: Analysis - To be filled by code_developer_

## Technical Spec (code_developer)

_Phase 2: Technical Spec - To be filled by code_developer_

## Implementation (code_developer)

_Phase 3: Implementation - To be filled by code_developer_

## Testing Results (code_developer)

_Phase 4: Testing - To be filled by code_developer_

## Regression Test

**Test File**: _Path to test file (e.g., `tests/test_bug_068_cfr-014_violation:_orchestrato.py`)_

**Test Name**: _Test function name (e.g., `test_bug_068_reproduction`)_

**Coverage**:
- [ ] Bug reproduction test added (fails before fix, passes after fix)
- [ ] Edge cases covered
- [ ] Test runs in CI/CD pipeline
- [ ] Test documentation added

**Notes**: _Additional testing notes, edge cases, or related tests_

## PR Link

_Phase 5: PR Creation - To be filled by code_developer_

---

**Workflow**: User â†’ project-manager â†’ code_developer â†’ Analysis â†’ Tech Spec â†’ Implementation â†’ Testing â†’ Regression Test â†’ PR â†’ Done

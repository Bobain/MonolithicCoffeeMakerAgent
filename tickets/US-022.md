# US-022: Consolidate langchain_observe Module Structure

**Status**: 📝 Planned
**Priority**: Medium
**Estimate**: 4-6 hours

## User Story
As a developer maintaining the codebase,
I want the langchain_observe directory to have a clear, organized structure with fewer files,
So that I can easily understand what modules to use and maintain the code efficiently.

## Problem
The `langchain_observe/` directory currently contains 38 Python files, which makes it:
- Hard to know what to use
- Difficult to navigate
- Confusing for new contributors
- Harder to maintain

## Current Structure (38 files)
```
langchain_observe/
├── Core: llm.py, llm_tools.py, agents.py, builder.py, utils.py, tools.py (6)
├── Strategies: retry.py, fallback.py, scheduling.py, context.py, metrics.py (5)
├── Providers: gemini.py, openai.py (2)
├── Cost: cost_budget.py, cost_calculator.py, token_estimator.py (3)
├── Rate limiting: rate_limiter.py, global_rate_tracker.py (2)
├── Analytics: analyzer.py, exporter.py, models.py, db_schema.py, + SQLite variants (8)
├── Support: response_parser.py, exceptions.py, langfuse_logger.py, http_pool.py, llm_config.py (5)
└── Misc: scheduled_llm.py, retry_utils.py, auto_picker_llm_refactored.py (3)
```

## Proposed Structure (~10 core modules)
```
langchain_observe/
├── core.py          # Core LLM interface (llm.py + llm_tools.py + builder.py)
├── agents.py        # Existing agents module
├── providers.py     # LLM providers (gemini.py + openai.py merged)
├── strategies.py    # All strategies merged (retry, fallback, scheduling, context, metrics)
├── cost_tracking.py # Cost management (cost_budget.py + cost_calculator.py + token_estimator.py)
├── rate_limiting.py # Rate limiting (rate_limiter.py + global_rate_tracker.py)
├── analytics.py     # Analytics consolidated (merge all 8 analytics files)
├── config.py        # Configuration (llm_config.py + relevant bits from utils.py)
├── exceptions.py    # Keep as is
└── integrations.py  # External integrations (langfuse_logger.py + http_pool.py + response_parser.py)
```

## Acceptance Criteria
- [ ] Reduce file count from 38 to ~10 core modules
- [ ] Each module has clear purpose documented in docstring
- [ ] All imports updated throughout codebase
- [ ] No functionality lost
- [ ] Tests still pass
- [ ] Update documentation to reflect new structure
- [ ] Create migration guide for any external users

## Benefits
- Easier to understand what each module does
- Simpler imports
- Better code discoverability
- Reduced cognitive load
- Easier onboarding for new contributors

## Technical Notes
- Use clear module-level docstrings explaining each module's purpose
- Keep public APIs unchanged where possible
- Consider adding `__all__` exports to control what's exposed
- Merge related functionality logically
- Keep analytics as single module (currently 8 files)

## Related
- Part of US-021 Code Refactoring & Technical Debt
- Supports developer maintainability goals

# US-028: Workflow Documentation in Python Docstrings (pydoc)

**Status**: 📝 Planned
**Priority**: Medium
**Estimate**: 2-3 hours

## User Story
As a **developer**,
I want to **see workflow diagrams and integration documentation in Python docstrings**,
So that **I can understand US-024 + US-027 workflows using `pydoc` command** without reading separate markdown files.

## Problem
Currently:
- ❌ Workflow documentation (US-024 + US-027) only exists in ticket markdown files
- ❌ Python docstrings lack visibility loop diagrams
- ❌ Developers must read multiple files to understand the workflow
- ❌ `pydoc` output doesn't explain the synchronization strategy
- ❌ No inline documentation showing how daemon + project-manager integrate

**Impact**:
- Developers can't quickly understand workflow using `pydoc coffee_maker.autonomous.daemon`
- Integration between US-024 + US-027 is not visible in code documentation
- Harder for new developers to understand the system
- Documentation scattered across multiple files

## Proposed Solution
Add comprehensive workflow documentation with ASCII diagrams to Python module docstrings.

### Files to Enhance

#### 1. `coffee_maker/autonomous/daemon.py`
Add to module docstring:
- US-027 workflow (sync FROM roadmap branch)
- US-024 workflow (merge TO roadmap branch - when implemented)
- Complete visibility loop diagram
- Benefits for code_developer and project_manager
- Code examples showing sync pattern

#### 2. `coffee_maker/cli/roadmap_cli.py`
Add to module docstring:
- US-027 workflow (manager side)
- Branch warning system explanation
- Best practices for viewing roadmap
- Visibility loop from manager perspective
- Example commands

#### 3. Other Relevant Modules (Optional)
- `coffee_maker/autonomous/git_manager.py` - Git workflow integration
- `coffee_maker/autonomous/roadmap_parser.py` - Parsing from roadmap branch
- `coffee_maker/config/manager.py` - Configuration related to branches

---

## Acceptance Criteria

### Must Have
- [ ] `daemon.py` module docstring includes US-024 + US-027 workflow
- [ ] `daemon.py` includes visibility loop ASCII diagram
- [ ] `roadmap_cli.py` module docstring includes branch warning explanation
- [ ] `roadmap_cli.py` includes best practices for roadmap branch
- [ ] All diagrams are ASCII-art compatible with `pydoc` output
- [ ] Documentation is visible via `python -m pydoc coffee_maker.autonomous.daemon`
- [ ] Documentation is visible via `python -m pydoc coffee_maker.cli.roadmap_cli`

### Should Have
- [ ] Code examples showing how sync works in practice
- [ ] Benefits section for both developer and manager
- [ ] Links to related user stories (US-024, US-027)
- [ ] Explanation of "single source of truth" principle

### Nice to Have
- [ ] Interactive examples in docstring
- [ ] Troubleshooting section for sync issues
- [ ] Performance notes (how often to sync)
- [ ] Migration guide from old workflow

---

## Documentation Format

### Module Docstring Structure
```python
"""Module description.

Brief overview of what this module does.

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📊 WORKFLOW INTEGRATION: US-024 + US-027 (VISIBILITY LOOP)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

This module implements...

US-027: Roadmap Branch as Single Source of Truth
────────────────────────────────────────────────
Description of US-027 workflow

    Code example showing sync pattern

US-024: Frequent Roadmap Sync
─────────────────────────────
Description of US-024 workflow

    Code example showing merge pattern

The Visibility Loop
───────────────────
ASCII diagram showing complete workflow

    ┌─────────────────────────────────────────────┐
    │   code_developer      project_manager       │
    │        │                    │                │
    │        ├─[Work]────►        │                │
    │        ├─[Merge]────►       │                │
    │        │              [View updates]         │
    │   [Sync]◄────[User feedback]                │
    │        └─[Continue]                          │
    └─────────────────────────────────────────────┘

Benefits:
    For code_developer:
    - Always works on latest priorities
    - Never wastes time on obsolete tasks

    For project_manager:
    - Real-time visibility
    - Early feedback opportunity

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Key Features:
    - Feature 1
    - Feature 2

Usage Examples:
    >>> # Example code
"""
```

---

## Example Implementation

### daemon.py Module Docstring Enhancement

**Before**:
```python
"""Autonomous development daemon - minimal MVP.

This module implements the core autonomous daemon that continuously reads
ROADMAP.md and autonomously implements features by invoking Claude API.

...existing documentation...
"""
```

**After**:
```python
"""Autonomous development daemon - minimal MVP.

This module implements the core autonomous daemon that continuously reads
ROADMAP.md and autonomously implements features by invoking Claude API.

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📊 WORKFLOW INTEGRATION: US-024 + US-027 (VISIBILITY LOOP)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

This daemon implements a dual workflow for real-time visibility between
code_developer (this daemon) and project_manager (user interface):

US-027: Roadmap Branch as Single Source of Truth (Developer Side)
──────────────────────────────────────────────────────────────────
The daemon ALWAYS syncs with 'roadmap' branch at the start of each iteration:

    def run():
        while True:
            # 1. SYNC FROM roadmap branch (US-027)
            _sync_roadmap_branch()  # Pull latest ROADMAP.md from origin/roadmap

            # 2. Read priorities
            next_priority = parser.get_next_planned_priority()

            # 3. Implement
            _implement_priority(next_priority)

            # 4. MERGE TO roadmap branch (US-024)
            # (Not yet implemented - see US-024.md)

            time.sleep(30)

Key principle: The 'roadmap' branch is the SINGLE SOURCE OF TRUTH.
All priority decisions, status updates, and planning changes MUST go
through the roadmap branch first.

US-024: Frequent Roadmap Sync (Developer → Manager Visibility)
───────────────────────────────────────────────────────────────
The daemon will merge to 'roadmap' branch frequently to show progress:

    Merge Triggers:
    - After completing sub-tasks
    - After updating ROADMAP.md
    - Before going idle/sleep
    - After creating tickets

    Implementation (planned):
        def _merge_to_roadmap(message: str):
            git checkout roadmap
            git merge --no-ff feature-branch -m message
            git push origin roadmap
            git checkout feature-branch

The Visibility Loop
───────────────────
Together, US-024 + US-027 create a continuous visibility loop:

    ┌─────────────────────────────────────────────────────────────┐
    │                  VISIBILITY LOOP                            │
    │                                                             │
    │   code_developer                    project_manager        │
    │   (this daemon)                     (user interface)        │
    │        │                                   │                │
    │        ├──[1. Work on feature]─────►      │                │
    │        │                                   │                │
    │        ├──[2. Merge to roadmap]────►  ┌───┴───┐            │
    │        │        (US-024)              │ See   │            │
    │        │                              │updates│            │
    │        │                              └───┬───┘            │
    │        │                                  │                │
    │        │   ┌──────────────────────────────┘                │
    │        │   │ [3. User provides feedback]                   │
    │        │   │    (updates ROADMAP.md on                     │
    │        │   │     roadmap branch)                           │
    │        │   │                                               │
    │   ┌────┴───▼────┐                                          │
    │   │ [4. Sync    │                                          │
    │   │  from       │                                          │
    │   │  roadmap]   │                                          │
    │   │  (US-027)   │                                          │
    │   └────┬────────┘                                          │
    │        │                                                   │
    │        └──[5. Continue with updated priorities]           │
    │                                                             │
    │   Result: Real-time visibility and early course            │
    │           correction without waiting for PR merge          │
    └─────────────────────────────────────────────────────────────┘

Benefits:
    For code_developer (daemon):
    - ✅ Always works on latest priorities
    - ✅ Never wastes time on obsolete tasks
    - ✅ Frequent checkpoints for recovery

    For project_manager (user):
    - ✅ Real-time visibility into progress
    - ✅ Can provide feedback early
    - ✅ No surprises at PR time

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

...existing documentation...
"""
```

---

## Implementation Plan

### Phase 1: daemon.py Enhancement (1 hour)
1. Add workflow integration section to module docstring
2. Include US-027 workflow description with code example
3. Include US-024 workflow description (planned)
4. Add complete visibility loop ASCII diagram
5. Add benefits section
6. Test with `python -m pydoc coffee_maker.autonomous.daemon`

### Phase 2: roadmap_cli.py Enhancement (30 minutes)
1. Add US-027 workflow from manager perspective
2. Include branch warning system explanation
3. Add best practices section
4. Add visibility loop diagram (manager view)
5. Test with `python -m pydoc coffee_maker.cli.roadmap_cli`

### Phase 3: Testing & Validation (30 minutes)
1. Run `pydoc` on both modules and verify readability
2. Ensure ASCII diagrams render correctly
3. Check that examples are clear and accurate
4. Validate links to related user stories work in terminal
5. Get feedback from team

---

## Benefits

### For Developers
- ✅ **Quick Reference**: View workflow with `pydoc` command
- ✅ **No Context Switching**: Documentation right in the code
- ✅ **Visual Diagrams**: ASCII art shows how components integrate
- ✅ **Code Examples**: See actual usage patterns inline

### For New Team Members
- ✅ **Faster Onboarding**: Understand workflow from code itself
- ✅ **Clear Architecture**: Diagrams explain integration points
- ✅ **Best Practices**: Learn proper usage from docstrings

### For Maintainability
- ✅ **Single Source**: Documentation lives with the code
- ✅ **Always Up-to-Date**: Changes to code prompt docstring updates
- ✅ **Easy Review**: PRs include both code and doc changes

---

## Testing Strategy

### Manual Testing
```bash
# Test daemon.py documentation
python -m pydoc coffee_maker.autonomous.daemon
# Should show: Visibility loop diagram, US-024/027 workflows

# Test roadmap_cli.py documentation
python -m pydoc coffee_maker.cli.roadmap_cli
# Should show: Branch warning, best practices, manager workflow

# Test in browser (HTML view)
python -m pydoc -b
# Navigate to modules and verify diagrams render correctly
```

### Validation Checklist
- [ ] ASCII diagrams are readable in terminal (80-column width)
- [ ] Unicode characters display correctly (box drawing, arrows)
- [ ] Code examples are syntactically correct
- [ ] Section headers are visually distinct
- [ ] Line breaks and spacing improve readability

---

## Related User Stories
- US-024: Frequent Roadmap Branch Synchronization (what this documents)
- US-027: Roadmap Branch as Single Source of Truth (what this documents)
- US-009: Documentation & Tutorials (general documentation)
- US-023: Settings Management (uses similar documentation style)

---

## Success Metrics

After implementation:
- Developers can understand workflow using only `pydoc` (no markdown files needed)
- New team members onboard 50% faster (from code documentation alone)
- 100% of key workflows have ASCII diagrams in docstrings
- Zero questions about "where is roadmap branch workflow documented?"

---

## Future Enhancements

### Phase 2 (Nice to Have)
- Add similar documentation to `git_manager.py`
- Create interactive documentation viewer
- Generate HTML docs from enhanced docstrings
- Add troubleshooting flowcharts in ASCII

### Phase 3 (Advanced)
- Auto-generate diagrams from code structure
- Link docstrings to Markdown tickets
- Create Sphinx documentation from enhanced docstrings

---

🤖 **Created**: 2025-10-11 by code_developer (autonomous)
**Estimated Implementation Time**: 2-3 hours
**Priority**: Medium (improves developer experience and documentation accessibility)

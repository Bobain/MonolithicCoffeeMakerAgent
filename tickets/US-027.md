# US-027: Real-Time Roadmap Updates for project_manager

**Status**: üìù Planned
**Priority**: High
**Estimate**: 3-4 hours

## User Story
As a **project_manager**,
I always want **the roadmap branch to be up-to-date with code_developer's work**,
So that I can **look at ROADMAP.md updates and see real-time progress**.

## Problem
Currently, as project_manager:
- ‚ùå Can't see code_developer's progress until PR is merged
- ‚ùå ROADMAP.md updates are invisible during feature development
- ‚ùå No way to know what code_developer is working on right now
- ‚ùå Must ask code_developer "what's the status?" manually
- ‚ùå Can't provide early feedback on direction

**Impact**:
- Poor visibility into ongoing work
- Late discovery of issues
- Inefficient communication
- Can't plan effectively
- User feels disconnected from development

## Proposed Solution
Ensure roadmap branch always reflects latest progress through:
1. **Automatic syncing** from code_developer (US-024)
2. **Real-time notifications** when roadmap updates
3. **Dashboard view** showing last sync time and status
4. **Progress indicators** in ROADMAP.md always current

### Relationship to US-024

**US-024** (code_developer perspective): "I want to merge frequently"
**US-027** (project_manager perspective): "I want to see updates frequently"

These are **two sides of the same coin**:
- US-024 = push side (developer syncs work)
- US-027 = pull side (manager consumes updates)

---

## Technical Implementation

### Phase 1: Ensure Automatic Syncing (Depends on US-024)

Implement all US-024 requirements:
- [x] code_developer merges to roadmap after sub-tasks
- [x] code_developer merges after ROADMAP.md updates
- [x] code_developer merges before sleep/idle
- [x] Automatic conflict detection and handling

**Status**: US-024 provides the foundation.

### Phase 2: Visibility Enhancements for project_manager

#### 2.1 Roadmap Sync Status Dashboard

**File**: `coffee_maker/cli/roadmap_sync_status.py`

```python
"""Display roadmap synchronization status for project_manager."""

from datetime import datetime
from pathlib import Path
import subprocess
from rich.console import Console
from rich.table import Table

def show_roadmap_sync_status():
    """Show when roadmap branch was last updated and by what."""

    console = Console()

    # Get last commit on roadmap branch
    result = subprocess.run(
        ["git", "log", "origin/roadmap", "-1", "--format=%H|%an|%ar|%s"],
        capture_output=True,
        text=True
    )

    if result.returncode != 0:
        console.print("‚ùå Could not fetch roadmap status", style="red")
        return

    commit_hash, author, time_ago, message = result.stdout.strip().split('|', 3)

    # Get current feature branches
    branches_result = subprocess.run(
        ["git", "branch", "-r", "--list", "origin/feature/*"],
        capture_output=True,
        text=True
    )

    feature_branches = [
        b.strip().replace("origin/", "")
        for b in branches_result.stdout.strip().split('\n')
        if b.strip()
    ]

    # Check if any feature branches are ahead of roadmap
    ahead_branches = []
    for branch in feature_branches:
        ahead_result = subprocess.run(
            ["git", "rev-list", "--count", f"origin/roadmap..origin/{branch}"],
            capture_output=True,
            text=True
        )
        commits_ahead = int(ahead_result.stdout.strip())
        if commits_ahead > 0:
            ahead_branches.append((branch, commits_ahead))

    # Display status
    console.print("\n" + "=" * 80)
    console.print("üìä ROADMAP SYNC STATUS", style="bold cyan")
    console.print("=" * 80 + "\n")

    # Last update info
    table = Table(title="Last Roadmap Update")
    table.add_column("Property", style="cyan")
    table.add_column("Value", style="green")

    table.add_row("Last Updated", time_ago)
    table.add_row("Commit", commit_hash[:8])
    table.add_row("Author", author)
    table.add_row("Message", message)

    console.print(table)

    # Feature branches status
    if ahead_branches:
        console.print("\n‚ö†Ô∏è  Feature branches with unsynced work:", style="yellow")
        for branch, commits in ahead_branches:
            console.print(f"  ‚Ä¢ {branch}: {commits} commit(s) ahead of roadmap")
        console.print("\nüí° Tip: These will be synced automatically by code_developer")
    else:
        console.print("\n‚úÖ All feature branches are synced to roadmap!", style="green")

    # ROADMAP.md last modified
    roadmap_path = Path("docs/ROADMAP.md")
    if roadmap_path.exists():
        mod_time = datetime.fromtimestamp(roadmap_path.stat().st_mtime)
        time_since = datetime.now() - mod_time
        minutes = int(time_since.total_seconds() / 60)

        console.print(f"\nüìù ROADMAP.md last modified: {minutes} minute(s) ago")

    console.print("\n" + "=" * 80 + "\n")
```

#### 2.2 Add Command to project-manager CLI

**File**: `coffee_maker/cli/roadmap_cli.py` (add new command)

```python
def cmd_roadmap_status(args: argparse.Namespace) -> int:
    """Show roadmap synchronization status.

    Displays:
    - When roadmap branch was last updated
    - What feature branches are ahead of roadmap
    - How long since ROADMAP.md was modified

    Args:
        args: Parsed command-line arguments

    Returns:
        0 on success, 1 on error

    Example:
        $ project-manager roadmap-status
    """
    from coffee_maker.cli.roadmap_sync_status import show_roadmap_sync_status

    try:
        show_roadmap_sync_status()
        return 0
    except Exception as e:
        print(f"‚ùå Error showing roadmap status: {e}")
        return 1
```

**Usage**:
```bash
# Check roadmap sync status anytime
project-manager roadmap-status

# Output:
# ==========================================
# üìä ROADMAP SYNC STATUS
# ==========================================
#
# Last Roadmap Update
# ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
# ‚îÇ Property     ‚îÇ Value                           ‚îÇ
# ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
# ‚îÇ Last Updated ‚îÇ 2 minutes ago                   ‚îÇ
# ‚îÇ Commit       ‚îÇ 5f820b5                         ‚îÇ
# ‚îÇ Author       ‚îÇ code_developer                  ‚îÇ
# ‚îÇ Message      ‚îÇ Merge feature/us-021: Add US... ‚îÇ
# ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
#
# ‚úÖ All feature branches are synced to roadmap!
#
# üìù ROADMAP.md last modified: 2 minute(s) ago
```

#### 2.3 Automatic Notifications on Roadmap Updates

**File**: `coffee_maker/cli/roadmap_watcher.py`

```python
"""Watch roadmap branch for updates and notify project_manager."""

import subprocess
import time
from pathlib import Path
from datetime import datetime

class RoadmapWatcher:
    """Monitor roadmap branch for updates."""

    def __init__(self, check_interval: int = 60):
        """Initialize watcher.

        Args:
            check_interval: Seconds between checks (default: 60)
        """
        self.check_interval = check_interval
        self.last_commit = None

    def get_latest_commit(self) -> str:
        """Get latest commit hash on roadmap branch."""
        result = subprocess.run(
            ["git", "fetch", "origin", "roadmap"],
            capture_output=True
        )

        result = subprocess.run(
            ["git", "rev-parse", "origin/roadmap"],
            capture_output=True,
            text=True
        )
        return result.stdout.strip()

    def check_for_updates(self) -> bool:
        """Check if roadmap has new commits.

        Returns:
            True if new commits found
        """
        current_commit = self.get_latest_commit()

        if self.last_commit is None:
            self.last_commit = current_commit
            return False

        if current_commit != self.last_commit:
            self.last_commit = current_commit
            return True

        return False

    def get_update_details(self) -> dict:
        """Get details about the latest update."""
        result = subprocess.run(
            ["git", "log", "origin/roadmap", "-1",
             "--format=%an|%ar|%s|%b"],
            capture_output=True,
            text=True
        )

        parts = result.stdout.strip().split('|', 3)
        return {
            "author": parts[0],
            "time_ago": parts[1],
            "message": parts[2],
            "body": parts[3] if len(parts) > 3 else ""
        }

    def notify_update(self, details: dict):
        """Notify user of roadmap update."""
        from rich.console import Console
        from rich.panel import Panel

        console = Console()

        notification = f"""
üîÑ **ROADMAP UPDATED**

**Author**: {details['author']}
**Time**: {details['time_ago']}
**Message**: {details['message']}

üí° View changes: `git pull origin roadmap` or check GitHub
"""

        console.print(Panel(
            notification,
            title="üìä Roadmap Branch Updated",
            border_style="cyan"
        ))

    def watch(self):
        """Watch for updates continuously."""
        from rich.console import Console
        console = Console()

        console.print("üëÄ Watching roadmap branch for updates...")
        console.print(f"   Checking every {self.check_interval} seconds")
        console.print("   Press Ctrl+C to stop\n")

        try:
            while True:
                if self.check_for_updates():
                    details = self.get_update_details()
                    self.notify_update(details)

                time.sleep(self.check_interval)
        except KeyboardInterrupt:
            console.print("\n\n‚úã Stopped watching roadmap")
```

**Usage**:
```bash
# Start watching roadmap for updates
project-manager watch-roadmap

# Or with custom interval
project-manager watch-roadmap --interval 30
```

#### 2.4 Visual Progress Indicators in ROADMAP.md

Enhance ROADMAP.md with real-time progress indicators:

```markdown
## üî¥ TOP PRIORITY FOR code_developer (START HERE)

**Last Updated**: 2025-10-11 15:30 (2 minutes ago) ‚ö° **FRESH**
**Updated By**: code_developer
**Branch**: feature/us-021-refactoring-phase-1

---

## üö® US-021 - Code Refactoring & Technical Debt Reduction

**Status**: üîÑ **IN PROGRESS** - Phase 1 Complete, PR Ready
**Last Sync**: 2 minutes ago ‚ö°
**Progress**: ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë 50% (Phase 1 of 2 complete)

**Recent Updates** (last 24h):
- ‚úÖ 15:28 - Created US-026 (Bug from PR comments)
- ‚úÖ 15:25 - Created US-025 (PR demo files)
- ‚úÖ 15:20 - Created US-024 (Frequent roadmap sync)
- ‚úÖ 14:45 - Completed File I/O migration (9/9 files)
- ‚úÖ 14:30 - Completed ConfigManager migration (15/15 files)

**Branch Status**: feature/us-021-refactoring-phase-1
- Commits ahead of roadmap: 0 (fully synced ‚úÖ)
- Last merge to roadmap: 2 minutes ago
- PR ready: Yes (see PR_US-021_PHASE_1.md)
```

---

## Acceptance Criteria

### Must Have
- [ ] `project-manager roadmap-status` command shows sync status
- [ ] Display when roadmap was last updated
- [ ] Show which feature branches are ahead of roadmap
- [ ] Show time since ROADMAP.md was modified
- [ ] Clear indication if roadmap is stale (>1 hour)
- [ ] Works from any directory in project

### Should Have
- [ ] `project-manager watch-roadmap` monitors for updates
- [ ] Desktop notification when roadmap updates (optional)
- [ ] Show author and commit message of last update
- [ ] Highlight if updates are from code_developer vs manual
- [ ] Warning if feature branches are >10 commits ahead

### Nice to Have
- [ ] Visual progress bars in ROADMAP.md
- [ ] "Recent Updates" section auto-generated
- [ ] Sync status widget in terminal prompt
- [ ] Email/Slack notification on roadmap updates
- [ ] Web dashboard showing real-time roadmap status
- [ ] GitHub Action that comments on PRs when synced to roadmap

---

## Benefits

### For project_manager
- ‚úÖ **Real-Time Visibility**: See progress as it happens
- ‚úÖ **No Manual Checking**: Automatic notifications on updates
- ‚úÖ **Clear Status**: Know if roadmap is fresh or stale
- ‚úÖ **Better Planning**: Make decisions based on current state
- ‚úÖ **Early Feedback**: Spot issues before PR is complete

### For code_developer
- ‚úÖ **Accountability**: Clear record of syncs
- ‚úÖ **Communication**: project_manager always informed
- ‚úÖ **Less Interruption**: No "status update" requests
- ‚úÖ **Motivation**: Visible progress encourages momentum

### For User
- ‚úÖ **Transparency**: Always know what's happening
- ‚úÖ **Trust**: Regular updates build confidence
- ‚úÖ **Engagement**: Can follow along with development
- ‚úÖ **Feedback**: Can provide input early and often

---

## User Workflow Examples

### Example 1: Morning Check

```bash
# User wants to see what happened overnight
$ project-manager roadmap-status

# Output shows:
# - Roadmap updated 3 hours ago
# - code_developer merged US-024 implementation
# - All feature branches synced
# - ROADMAP.md modified 3 hours ago

# User is happy - knows exactly what's new! ‚úÖ
```

### Example 2: Continuous Monitoring

```bash
# User starts monitoring while working
$ project-manager watch-roadmap

# Terminal shows:
# üëÄ Watching roadmap branch for updates...
#    Checking every 60 seconds
#    Press Ctrl+C to stop

# ... 5 minutes later ...

# üîÑ ROADMAP UPDATED
#
# Author: code_developer
# Time: just now
# Message: Merge feature/us-021: Complete File I/O migration
#
# üí° View changes: git pull origin roadmap

# User sees update immediately! ‚úÖ
```

### Example 3: Quick Status Check

```bash
# User wonders if roadmap is current
$ project-manager roadmap-status

# Output shows:
# ‚ö†Ô∏è  Feature branches with unsynced work:
#   ‚Ä¢ feature/us-021-refactoring-phase-1: 3 commits ahead
#
# üí° Tip: These will be synced automatically by code_developer

# User knows code_developer has unsynced work, but it's expected ‚úÖ
```

---

## Implementation Plan

### Phase 1: Basic Status Display (1 hour)
- [ ] Create `roadmap_sync_status.py`
- [ ] Add `roadmap-status` command to CLI
- [ ] Display last commit info
- [ ] Show feature branches status

### Phase 2: Real-Time Monitoring (1 hour)
- [ ] Create `roadmap_watcher.py`
- [ ] Add `watch-roadmap` command
- [ ] Implement polling mechanism
- [ ] Add notifications on updates

### Phase 3: Enhanced Indicators (1 hour)
- [ ] Add progress bars to ROADMAP.md
- [ ] Auto-generate "Recent Updates" section
- [ ] Show branch sync status in ROADMAP
- [ ] Add freshness indicators (‚ö° FRESH, ‚ö†Ô∏è STALE)

### Phase 4: Integration & Testing (1 hour)
- [ ] Test with US-024 workflow
- [ ] Verify notifications work
- [ ] Test from different directories
- [ ] Update documentation

---

## Success Metrics

After implementation:
- project_manager checks roadmap status 5+ times per day (easy access)
- 100% awareness of code_developer progress
- <5 minute delay from code_developer sync to project_manager awareness
- 0 "what's the status?" questions (self-service visibility)
- User satisfaction with progress transparency: 9/10+

---

## Integration with Existing Features

### Works With US-024
- **US-024** ensures roadmap is synced frequently
- **US-027** ensures project_manager can see those syncs
- Together they create a complete visibility loop

### Enhances Developer Status (PRIORITY 4)
- `developer-status` shows what code_developer is doing NOW
- `roadmap-status` shows what was synced to roadmap WHEN
- Complementary views of progress

### Supports PR Workflow (US-025, US-026)
- See when PR demo files are added
- Know when new bug issues are created
- Track PR progress through roadmap updates

---

## Technical Notes

### Git Commands Used
```bash
# Get last commit on roadmap
git log origin/roadmap -1 --format="%H|%an|%ar|%s"

# Check if feature branch is ahead
git rev-list --count origin/roadmap..origin/feature/us-021

# Fetch latest roadmap
git fetch origin roadmap

# Get file modification time
stat -f "%Sm" docs/ROADMAP.md
```

### Polling vs Webhooks
- **Polling** (implemented): Simple, works locally
- **Webhooks** (future): Real-time, requires GitHub App
- Start with polling, upgrade to webhooks if needed

### Notification Channels
- **Terminal**: Rich console output (default)
- **Desktop**: `notify-send` or `osascript` (optional)
- **Email**: SMTP for critical updates (optional)
- **Slack**: Webhook integration (optional)

---

## Related User Stories
- **US-024**: Frequent Roadmap Synchronization (code_developer side)
- **US-025**: PR Demo Files (helps project_manager test)
- **US-026**: Bug from PR Comments (tracks issues found by project_manager)
- **PRIORITY 4**: Developer Status Dashboard (real-time task status)

---

## Example: Real-World Usage

**Scenario**: User (project_manager) working on other tasks while code_developer is autonomous

**9:00 AM** - User starts terminal session
```bash
$ project-manager watch-roadmap &
# Watcher starts in background
```

**9:15 AM** - code_developer completes ConfigManager migration
```
üîÑ ROADMAP UPDATED
Author: code_developer
Message: Merge feature/us-021: ConfigManager migration complete (15 files)
```

**10:30 AM** - code_developer completes File I/O utilities
```
üîÑ ROADMAP UPDATED
Author: code_developer
Message: Merge feature/us-021: File I/O utilities migration complete (9 files)
```

**11:45 AM** - code_developer creates new user stories
```
üîÑ ROADMAP UPDATED
Author: code_developer
Message: Merge feature/us-021: Create US-025 and US-026
```

**12:00 PM** - User checks overall status
```bash
$ project-manager roadmap-status

# Output shows all morning's updates
# User is fully informed without interrupting code_developer! ‚úÖ
```

---

## Questions for User Feedback

After implementation, ask user:
1. How often do you check `roadmap-status`?
2. Is the `watch-roadmap` feature useful or distracting?
3. What other information would help you track progress?
4. Should we add email/Slack notifications?
5. Is the update frequency (from US-024) appropriate?

---

ü§ñ **Created**: 2025-10-11 by code_developer (autonomous)
**Estimated Implementation Time**: 3-4 hours
**Priority**: High (critical for project_manager visibility)
**Depends On**: US-024 (provides the syncs to monitor)
